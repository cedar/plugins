/*======================================================================================================================

    Copyright 2011 Institut fuer Neuroinformatik, Ruhr-Universitaet Bochum, Germany

    This file is part of cedar.

    cedar is free software: you can redistribute it and/or modify it under
    the terms of the GNU Lesser General Public License as published by the
    Free Software Foundation, either version 3 of the License, or (at your
    option) any later version.

    cedar is distributed in the hope that it will be useful, but WITHOUT ANY
    WARRANTY; without even the implied warranty of MERCHANTABILITY or
    FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public
    License for more details.

    You should have received a copy of the GNU Lesser General Public License
    along with cedar. If not, see <http://www.gnu.org/licenses/>.

========================================================================================================================

    Institute:   Ruhr-Universitaet Bochum
                 Institut fuer Neuroinformatik

    File:        NeuralTimer.cpp

    Maintainer:  
    Email:       
    Date:        

    Description:

    Credits:

======================================================================================================================*/

// LOCAL INCLUDES
#include "steps/neuraloscillator/NeuralTimer.h"
#include "ApproximateInput.h"
#include "ApproximateCoupling.h"
#include "ApproximateCouplingVector.h"

// SYSTEM INCLUDES
#include <cedar/auxiliaries/assert.h>
#include <cedar/auxiliaries/exceptions.h>
#include <cedar/auxiliaries/DataTemplate.h>
#include <cedar/auxiliaries/MatData.h>
#include <cedar/auxiliaries/BoolParameter.h>
#include <cedar/auxiliaries/UIntParameter.h>
#include <cedar/auxiliaries/DoubleParameter.h>
#include <cedar/auxiliaries/ObjectParameterTemplate.h>
#include <cedar/auxiliaries/math/TransferFunction.h>
#include <cedar/auxiliaries/math/transferFunctions/AbsSigmoid.h>
#include <cedar/auxiliaries/math/tools.h>
#include <cmath>
#include <boost/pointer_cast.hpp>
#include <iostream>

//----------------------------------------------------------------------------------------------------------------------
// constructors and destructor
//----------------------------------------------------------------------------------------------------------------------

cedar::proc::steps::NeuralTimer::NeuralTimer()
:
mMatrixWBase(new cedar::aux::MatData(cv::Mat::zeros(1, 1, CV_32F))),
mMatrixWMod(new cedar::aux::MatData(cv::Mat::zeros(1, 1, CV_32F))),
mCouplingOut(new cedar::aux::MatData(cv::Mat::zeros(1, 1, CV_32F))),
_mTau(new cedar::aux::DoubleParameter(this, "tau", 1.0)),
_mH(new cedar::aux::DoubleParameter(this, "h", 1.0)),
_mS(new cedar::aux::DoubleParameter(this, "s", 1.0))
{
  // input
  this->declareInput("desired duration");
  //this->declareInput("desired distance");

  // output
  this->declareOutput("integral basis", mMatrixWBase);
  this->declareOutput("integral mod", mMatrixWMod);
  this->declareOutput("coupling", mCouplingOut);
  
  QObject::connect(_mTau.get(), SIGNAL(valueChanged()), this, SLOT(stuffChanged()));
  QObject::connect(_mH.get(), SIGNAL(valueChanged()), this, SLOT(stuffChanged()));

  QObject::connect(_mS.get(), SIGNAL(valueChanged()), this, SLOT(stuffChanged()));

  this->recompute();
}

cedar::proc::steps::NeuralTimer::~NeuralTimer()
{
}

//----------------------------------------------------------------------------------------------------------------------
// methods
//----------------------------------------------------------------------------------------------------------------------

void cedar::proc::steps::NeuralTimer::stuffChanged()
{
  recompute();
}

void cedar::proc::steps::NeuralTimer::recompute()
{
  auto durationInput = getInput("desired duration");

  if (!durationInput)
    return;

  /*
  auto distanceInput = getInput("desired distance");
  if (!distanceInput)
    return;
  */

  cv::Mat durationMat = durationInput->getData<cv::Mat>();
  if (durationMat.empty())
    return;

  /*
  cv::Mat distanceMat = distanceInput->getData<cv::Mat>();
  if (!distanceMat.empty())
    return;
  */

  float s = _mS->getValue();

  float tau = _mTau->getValue() / 1000.0;
  float h = _mH->getValue();

  float tf = durationMat.at<float>(0,0);
  float c = calculateCouplingFromTF( tf );

  mCouplingOut->getData().at<float>(0,0) = c;


  // Base Integral: 0 to tf
  mMatrixWBase->getData().at<float>(0,0) = calculateBaseIntegral(s, c, tf, tau, h);

  // Modulated Integral: 0 to tofmax
  float tofmax = calculateTMaxOfU(c);

  mMatrixWMod->getData().at<float>(0,0) = calculateModIntegral(s, c, tofmax, tau, h);

//std::cout << " tf: " << tf << ", c: " << c << ", tau: " << tau << " h " << h << " s: " << s <<  "     tofmax: " << tofmax << "  Wbase: " << mMatrixWBase->getData().at<float>(0,0) << "  Wmod: " << mMatrixWMod->getData().at<float>(0,0) << std::endl;
}


void cedar::proc::steps::NeuralTimer::compute(const cedar::proc::Arguments&)
{
  recompute();
}

float cedar::proc::steps::NeuralTimer::calculateCouplingFromTF(float tf)
 {
  static const std::vector<float> times = {3.1400734e+00, 3.0168367e+00, 2.9136645e+00, 2.8242125e+00, 2.7448741e+00,
                                     2.6733719e+00, 2.6081615e+00, 2.5481397e+00, 2.4924869e+00, 2.4405746e+00,
                                     2.3919088e+00, 2.3460928e+00, 2.3028029e+00, 2.2617705e+00, 2.2227700e+00,
                                     2.1856099e+00, 2.1501259e+00, 2.1161759e+00, 2.0836361e+00, 2.0523976e+00,
                                     2.0223644e+00, 1.9934510e+00, 1.9655813e+00, 1.9386867e+00, 1.9127057e+00,
                                     1.8875824e+00, 1.8632661e+00, 1.8397106e+00, 1.8168737e+00, 1.7947167e+00,
                                     1.7732040e+00, 1.7523028e+00, 1.7319827e+00, 1.7122156e+00, 1.6929755e+00,
                                     1.6742381e+00, 1.6559808e+00, 1.6381825e+00, 1.6208235e+00, 1.6038853e+00,
                                     1.5873505e+00, 1.5712030e+00, 1.5554273e+00, 1.5400090e+00, 1.5249346e+00,
                                     1.5101911e+00, 1.4957664e+00, 1.4816491e+00, 1.4678281e+00, 1.4542932e+00,
                                     1.4410346e+00, 1.4280429e+00, 1.4153092e+00, 1.4028252e+00, 1.3905827e+00,
                                     1.3785741e+00, 1.3667921e+00, 1.3552296e+00, 1.3438801e+00, 1.3327371e+00,
                                     1.3217944e+00, 1.3110463e+00, 1.3004872e+00, 1.2901115e+00, 1.2799143e+00,
                                     1.2698905e+00, 1.2600354e+00, 1.2503443e+00, 1.2408130e+00, 1.2314371e+00,
                                     1.2222127e+00, 1.2131357e+00, 1.2042025e+00, 1.1954093e+00, 1.1867527e+00,
                                     1.1782292e+00, 1.1698357e+00, 1.1615689e+00, 1.1534259e+00, 1.1454036e+00,
                                     1.1374992e+00, 1.1297100e+00, 1.1220334e+00, 1.1144667e+00, 1.1070074e+00,
                                     1.0996532e+00, 1.0924016e+00, 1.0852506e+00, 1.0781977e+00, 1.0712410e+00,
                                     1.0643784e+00, 1.0576078e+00, 1.0509273e+00, 1.0443351e+00, 1.0378292e+00,
                                     1.0314080e+00, 1.0250697e+00, 1.0188126e+00, 1.0126352e+00, 1.0065357e+00,
                                     1.0005127e+00, 9.9456464e-01, 9.8869012e-01, 9.8288770e-01, 9.7715599e-01,
                                     9.7149365e-01, 9.6589938e-01, 9.6037190e-01, 9.5490997e-01, 9.4951237e-01,
                                     9.4417794e-01, 9.3890551e-01, 9.3369398e-01, 9.2854225e-01, 9.2344926e-01,
                                     9.1841396e-01, 9.1343534e-01, 9.0851241e-01, 9.0364421e-01, 8.9882980e-01,
                                     8.9406826e-01, 8.8935868e-01, 8.8470019e-01, 8.8009194e-01, 8.7553308e-01,
                                     8.7102280e-01, 8.6656030e-01, 8.6214480e-01, 8.5777553e-01, 8.5345175e-01,
                                     8.4917272e-01, 8.4493774e-01, 8.4074609e-01, 8.3659711e-01, 8.3249012e-01,
                                     8.2842447e-01, 8.2439951e-01, 8.2041463e-01, 8.1646920e-01, 8.1256263e-01,
                                     8.0869432e-01, 8.0486370e-01, 8.0107021e-01, 7.9731330e-01, 7.9359242e-01,
                                     7.8990704e-01, 7.8625664e-01, 7.8264071e-01, 7.7905876e-01, 7.7551030e-01,
                                     7.7199483e-01, 7.6851190e-01, 7.6506104e-01, 7.6164181e-01, 7.5825374e-01,
                                     7.5489642e-01, 7.5156941e-01, 7.4827230e-01, 7.4500467e-01, 7.4176612e-01,
                                     7.3855625e-01, 7.3537468e-01, 7.3222103e-01, 7.2909491e-01, 7.2599597e-01,
                                     7.2292384e-01, 7.1987816e-01, 7.1685860e-01, 7.1386480e-01, 7.1089643e-01,
                                     7.0795316e-01, 7.0503468e-01, 7.0214065e-01, 6.9927077e-01, 6.9642472e-01,
                                     6.9360222e-01, 6.9080295e-01, 6.8802664e-01, 6.8527298e-01, 6.8254170e-01,
                                     6.7983253e-01, 6.7714519e-01, 6.7447941e-01, 6.7183493e-01, 6.6921148e-01,
                                     6.6660882e-01, 6.6402670e-01, 6.6146486e-01, 6.5892307e-01, 6.5640108e-01,
                                     6.5389866e-01, 6.5141559e-01, 6.4895162e-01, 6.4650655e-01, 6.4408014e-01,
                                     6.4167218e-01, 6.3928246e-01, 6.3691077e-01, 6.3455691e-01, 6.3222066e-01,
                                     6.2990182e-01, 6.2760021e-01, 6.2531563e-01, 6.2304787e-01, 6.2079677e-01,
                                     6.1856212e-01, 6.1634376e-01, 6.1414149e-01, 6.1195514e-01, 6.0978453e-01,
                                     6.0762950e-01, 6.0548988e-01, 6.0336549e-01, 6.0125617e-01, 5.9916176e-01,
                                     5.9708211e-01, 5.9501704e-01, 5.9296642e-01, 5.9093007e-01, 5.8890786e-01,
                                     5.8689963e-01, 5.8490525e-01, 5.8292455e-01, 5.8095741e-01, 5.7900367e-01,
                                     5.7706321e-01, 5.7513588e-01, 5.7322155e-01, 5.7132009e-01, 5.6943136e-01,
                                     5.6755525e-01, 5.6569161e-01, 5.6384032e-01, 5.6200127e-01, 5.6017432e-01,
                                     5.5835936e-01, 5.5655627e-01, 5.5476492e-01, 5.5298521e-01, 5.5121702e-01,
                                     5.4946024e-01, 5.4771475e-01, 5.4598045e-01, 5.4425722e-01, 5.4254497e-01,
                                     5.4084358e-01, 5.3915295e-01, 5.3747297e-01, 5.3580355e-01, 5.3414459e-01,
                                     5.3249598e-01, 5.3085763e-01, 5.2922944e-01, 5.2761132e-01, 5.2600317e-01,
                                     5.2440490e-01, 5.2281642e-01, 5.2123763e-01, 5.1966845e-01, 5.1810879e-01,
                                     5.1655856e-01, 5.1501768e-01, 5.1348606e-01, 5.1196361e-01, 5.1045026e-01,
                                     5.0894592e-01, 5.0745050e-01, 5.0596394e-01, 5.0448615e-01, 5.0301705e-01,
                                     5.0155657e-01, 5.0010462e-01, 4.9866114e-01, 4.9722604e-01, 4.9579927e-01,
                                     4.9438073e-01, 4.9297037e-01, 4.9156810e-01, 4.9017386e-01, 4.8878759e-01,
                                     4.8740920e-01, 4.8603864e-01, 4.8467584e-01, 4.8332072e-01, 4.8197323e-01,
                                     4.8063330e-01, 4.7930086e-01, 4.7797586e-01, 4.7665823e-01, 4.7534790e-01,
                                     4.7404482e-01, 4.7274893e-01, 4.7146017e-01, 4.7017847e-01, 4.6890378e-01,
                                     4.6763604e-01, 4.6637520e-01, 4.6512119e-01, 4.6387396e-01, 4.6263346e-01,
                                     4.6139964e-01, 4.6017242e-01, 4.5895178e-01, 4.5773764e-01, 4.5652996e-01,
                                     4.5532869e-01, 4.5413377e-01, 4.5294516e-01, 4.5176280e-01, 4.5058665e-01,
                                     4.4941665e-01, 4.4825276e-01, 4.4709493e-01, 4.4594310e-01, 4.4479725e-01,
                                     4.4365731e-01, 4.4252324e-01, 4.4139500e-01, 4.4027254e-01, 4.3915582e-01,
                                     4.3804479e-01, 4.3693940e-01, 4.3583962e-01, 4.3474541e-01, 4.3365671e-01,
                                     4.3257349e-01, 4.3149571e-01, 4.3042332e-01, 4.2935629e-01, 4.2829457e-01,
                                     4.2723813e-01, 4.2618692e-01, 4.2514090e-01, 4.2410005e-01, 4.2306431e-01,
                                     4.2203365e-01, 4.2100804e-01, 4.1998743e-01, 4.1897179e-01, 4.1796109e-01,
                                     4.1695528e-01, 4.1595433e-01, 4.1495821e-01, 4.1396687e-01, 4.1298030e-01,
                                     4.1199844e-01, 4.1102128e-01, 4.1004876e-01, 4.0908087e-01, 4.0811756e-01,
                                     4.0715881e-01, 4.0620458e-01, 4.0525484e-01, 4.0430956e-01, 4.0336870e-01,
                                     4.0243224e-01, 4.0150015e-01, 4.0057239e-01, 3.9964893e-01, 3.9872974e-01,
                                     3.9781480e-01, 3.9690408e-01, 3.9599753e-01, 3.9509515e-01, 3.9419689e-01,
                                     3.9330273e-01, 3.9241264e-01, 3.9152660e-01, 3.9064456e-01, 3.8976652e-01,
                                     3.8889244e-01, 3.8802229e-01, 3.8715605e-01, 3.8629369e-01, 3.8543518e-01,
                                     3.8458050e-01, 3.8372963e-01, 3.8288253e-01, 3.8203918e-01, 3.8119956e-01,
                                     3.8036365e-01, 3.7953141e-01, 3.7870283e-01, 3.7787787e-01, 3.7705652e-01,
                                     3.7623875e-01, 3.7542454e-01, 3.7461387e-01, 3.7380670e-01, 3.7300303e-01,
                                     3.7220282e-01, 3.7140605e-01, 3.7061271e-01, 3.6982276e-01, 3.6903620e-01,
                                     3.6825299e-01, 3.6747311e-01, 3.6669654e-01, 3.6592327e-01, 3.6515327e-01,
                                     3.6438652e-01, 3.6362299e-01, 3.6286268e-01, 3.6210555e-01, 3.6135159e-01,
                                     3.6060078e-01, 3.5985310e-01, 3.5910853e-01, 3.5836705e-01, 3.5762864e-01,
                                     3.5689327e-01, 3.5616094e-01, 3.5543163e-01, 3.5470531e-01, 3.5398196e-01,
                                     3.5326158e-01, 3.5254413e-01, 3.5182960e-01, 3.5111798e-01, 3.5040924e-01,
                                     3.4970337e-01, 3.4900036e-01, 3.4830017e-01, 3.4760281e-01, 3.4690824e-01,
                                     3.4621645e-01, 3.4552743e-01, 3.4484116e-01, 3.4415763e-01, 3.4347680e-01,
                                     3.4279868e-01, 3.4212324e-01, 3.4145047e-01, 3.4078036e-01, 3.4011288e-01,
                                     3.3944801e-01, 3.3878576e-01, 3.3812609e-01, 3.3746900e-01, 3.3681447e-01,
                                     3.3616249e-01, 3.3551303e-01, 3.3486609e-01, 3.3422165e-01, 3.3357969e-01,
                                     3.3294021e-01, 3.3230318e-01, 3.3166859e-01, 3.3103644e-01, 3.3040670e-01,
                                     3.2977936e-01, 3.2915441e-01, 3.2853183e-01, 3.2791161e-01, 3.2729374e-01,
                                     3.2667820e-01, 3.2606498e-01, 3.2545406e-01, 3.2484545e-01, 3.2423911e-01,
                                     3.2363504e-01, 3.2303322e-01, 3.2243365e-01, 3.2183631e-01, 3.2124119e-01,
                                     3.2064827e-01, 3.2005754e-01, 3.1946899e-01, 3.1888262e-01, 3.1829840e-01,
                                     3.1771632e-01, 3.1713638e-01, 3.1655856e-01, 3.1598284e-01, 3.1540923e-01,
                                     3.1483770e-01, 3.1426825e-01, 3.1370086e-01, 3.1313552e-01, 3.1257223e-01,
                                     3.1201096e-01, 3.1145171e-01, 3.1089447e-01, 3.1033923e-01, 3.0978598e-01,
                                     3.0923470e-01, 3.0868539e-01, 3.0813803e-01, 3.0759262e-01, 3.0704914e-01,
                                     3.0650758e-01, 3.0596794e-01, 3.0543020e-01, 3.0489435e-01, 3.0436039e-01,
                                     3.0382830e-01, 3.0329808e-01, 3.0276970e-01, 3.0224318e-01, 3.0171848e-01,
                                     3.0119561e-01, 3.0067456e-01, 3.0015531e-01, 2.9963786e-01, 2.9912219e-01,
                                     2.9860830e-01, 2.9809618e-01, 2.9758582e-01, 2.9707721e-01, 2.9657034e-01,
                                     2.9606520e-01, 2.9556179e-01, 2.9506009e-01, 2.9456010e-01, 2.9406180e-01,
                                     2.9356519e-01, 2.9307026e-01, 2.9257700e-01, 2.9208541e-01, 2.9159547e-01,
                                     2.9110717e-01, 2.9062052e-01, 2.9013549e-01, 2.8965208e-01, 2.8917029e-01,
                                     2.8869010e-01, 2.8821151e-01, 2.8773451e-01, 2.8725909e-01, 2.8678524e-01,
                                     2.8631296e-01, 2.8584223e-01, 2.8537305e-01, 2.8490542e-01, 2.8443932e-01,
                                     2.8397475e-01, 2.8351170e-01, 2.8305016e-01, 2.8259012e-01, 2.8213158e-01,
                                     2.8167453e-01, 2.8121897e-01, 2.8076488e-01, 2.8031226e-01, 2.7986110e-01,
                                     2.7941139e-01, 2.7896313e-01, 2.7851631e-01, 2.7807092e-01, 2.7762696e-01,
                                     2.7718442e-01, 2.7674329e-01, 2.7630357e-01, 2.7586524e-01, 2.7542831e-01,
                                     2.7499277e-01, 2.7455860e-01, 2.7412580e-01, 2.7369437e-01, 2.7326431e-01,
                                     2.7283559e-01, 2.7240822e-01, 2.7198219e-01, 2.7155750e-01, 2.7113413e-01,
                                     2.7071208e-01, 2.7029135e-01, 2.6987193e-01, 2.6945381e-01, 2.6903699e-01,
                                     2.6862146e-01, 2.6820722e-01, 2.6779425e-01, 2.6738256e-01, 2.6697213e-01,
                                     2.6656296e-01, 2.6615505e-01, 2.6574839e-01, 2.6534298e-01, 2.6493880e-01,
                                     2.6453586e-01, 2.6413414e-01, 2.6373364e-01, 2.6333436e-01, 2.6293629e-01,
                                     2.6253942e-01, 2.6214375e-01, 2.6174928e-01, 2.6135600e-01, 2.6096389e-01,
                                     2.6057297e-01, 2.6018322e-01, 2.5979463e-01, 2.5940721e-01, 2.5902094e-01,
                                     2.5863582e-01, 2.5825185e-01, 2.5786903e-01, 2.5748733e-01, 2.5710677e-01,
                                     2.5672734e-01, 2.5634902e-01, 2.5597182e-01, 2.5559574e-01, 2.5522076e-01,
                                     2.5484687e-01, 2.5447409e-01, 2.5410240e-01, 2.5373179e-01, 2.5336227e-01,
                                     2.5299382e-01, 2.5262645e-01, 2.5226014e-01, 2.5189490e-01, 2.5153072e-01,
                                     2.5116758e-01, 2.5080550e-01, 2.5044447e-01, 2.5008447e-01, 2.4972551e-01,
                                     2.4936758e-01, 2.4901068e-01, 2.4865480e-01, 2.4829994e-01, 2.4794609e-01,
                                     2.4759325e-01, 2.4724142e-01, 2.4689058e-01, 2.4654075e-01, 2.4619190e-01,
                                     2.4584404e-01, 2.4549717e-01, 2.4515128e-01, 2.4480636e-01, 2.4446241e-01,
                                     2.4411943e-01, 2.4377742e-01, 2.4343636e-01, 2.4309626e-01, 2.4275711e-01,
                                     2.4241890e-01, 2.4208164e-01, 2.4174532e-01, 2.4140993e-01, 2.4107547e-01,
                                     2.4074195e-01, 2.4040934e-01, 2.4007766e-01, 2.3974689e-01, 2.3941703e-01,
                                     2.3908808e-01, 2.3876003e-01, 2.3843289e-01, 2.3810664e-01, 2.3778129e-01,
                                     2.3745683e-01, 2.3713325e-01, 2.3681055e-01, 2.3648874e-01, 2.3616779e-01,
                                     2.3584772e-01, 2.3552852e-01, 2.3521019e-01, 2.3489271e-01, 2.3457609e-01,
                                     2.3426033e-01, 2.3394541e-01, 2.3363135e-01, 2.3331812e-01, 2.3300574e-01,
                                     2.3269420e-01, 2.3238348e-01, 2.3207360e-01, 2.3176455e-01, 2.3145632e-01,
                                     2.3114891e-01, 2.3084231e-01, 2.3053653e-01, 2.3023156e-01, 2.2992740e-01,
                                     2.2962404e-01, 2.2932149e-01, 2.2901973e-01, 2.2871876e-01, 2.2841859e-01,
                                     2.2811920e-01, 2.2782060e-01, 2.2752279e-01, 2.2722575e-01, 2.2692949e-01,
                                     2.2663400e-01, 2.2633928e-01, 2.2604532e-01, 2.2575214e-01, 2.2545971e-01,
                                     2.2516804e-01, 2.2487712e-01, 2.2458696e-01, 2.2429755e-01, 2.2400888e-01,
                                     2.2372096e-01, 2.2343377e-01, 2.2314733e-01, 2.2286161e-01, 2.2257664e-01,
                                     2.2229239e-01, 2.2200886e-01, 2.2172606e-01, 2.2144398e-01, 2.2116262e-01,
                                     2.2088198e-01, 2.2060204e-01, 2.2032282e-01, 2.2004430e-01, 2.1976649e-01,
                                     2.1948938e-01, 2.1921297e-01, 2.1893726e-01, 2.1866224e-01, 2.1838791e-01,
                                     2.1811427e-01, 2.1784131e-01, 2.1756904e-01, 2.1729745e-01, 2.1702654e-01,
                                     2.1675630e-01, 2.1648674e-01, 2.1621785e-01, 2.1594963e-01, 2.1568207e-01,
                                     2.1541517e-01, 2.1514894e-01, 2.1488336e-01, 2.1461844e-01, 2.1435418e-01,
                                     2.1409056e-01, 2.1382760e-01, 2.1356528e-01, 2.1330360e-01, 2.1304256e-01,
                                     2.1278217e-01, 2.1252241e-01, 2.1226329e-01, 2.1200479e-01, 2.1174693e-01,
                                     2.1148970e-01, 2.1123309e-01, 2.1097710e-01, 2.1072173e-01, 2.1046698e-01,
                                     2.1021285e-01, 2.0995934e-01, 2.0970643e-01, 2.0945413e-01, 2.0920244e-01,
                                     2.0895136e-01, 2.0870088e-01, 2.0845100e-01, 2.0820171e-01, 2.0795303e-01,
                                     2.0770494e-01, 2.0745744e-01, 2.0721053e-01, 2.0696421e-01, 2.0671847e-01,
                                     2.0647332e-01, 2.0622875e-01, 2.0598476e-01, 2.0574135e-01, 2.0549851e-01,
                                     2.0525625e-01, 2.0501455e-01, 2.0477343e-01, 2.0453287e-01, 2.0429288e-01,
                                     2.0405346e-01, 2.0381459e-01, 2.0357628e-01, 2.0333854e-01, 2.0310134e-01,
                                     2.0286470e-01, 2.0262861e-01, 2.0239307e-01, 2.0215808e-01, 2.0192364e-01,
                                     2.0168974e-01, 2.0145638e-01, 2.0122356e-01, 2.0099128e-01, 2.0075953e-01,
                                     2.0052832e-01, 2.0029765e-01, 2.0006750e-01, 1.9983788e-01, 1.9960879e-01,
                                     1.9938023e-01, 1.9915219e-01, 1.9892467e-01, 1.9869767e-01, 1.9847119e-01,
                                     1.9824522e-01, 1.9801977e-01, 1.9779483e-01, 1.9757041e-01, 1.9734649e-01,
                                     1.9712308e-01, 1.9690018e-01, 1.9667778e-01, 1.9645588e-01, 1.9623449e-01,
                                     1.9601359e-01, 1.9579319e-01, 1.9557329e-01, 1.9535388e-01, 1.9513496e-01,
                                     1.9491654e-01, 1.9469860e-01, 1.9448115e-01, 1.9426419e-01, 1.9404771e-01,
                                     1.9383171e-01, 1.9361620e-01, 1.9340116e-01, 1.9318660e-01, 1.9297252e-01,
                                     1.9275891e-01, 1.9254577e-01, 1.9233311e-01, 1.9212092e-01, 1.9190919e-01,
                                     1.9169793e-01, 1.9148714e-01, 1.9127681e-01, 1.9106694e-01, 1.9085753e-01,
                                     1.9064859e-01, 1.9044010e-01, 1.9023206e-01, 1.9002448e-01, 1.8981735e-01,
                                     1.8961068e-01, 1.8940445e-01, 1.8919868e-01, 1.8899335e-01, 1.8878847e-01,
                                     1.8858403e-01, 1.8838003e-01, 1.8817648e-01, 1.8797336e-01, 1.8777068e-01,
                                     1.8756845e-01, 1.8736664e-01, 1.8716527e-01, 1.8696434e-01, 1.8676383e-01,
                                     1.8656376e-01, 1.8636411e-01, 1.8616489e-01, 1.8596610e-01, 1.8576773e-01,
                                     1.8556979e-01, 1.8537226e-01, 1.8517516e-01, 1.8497848e-01, 1.8478221e-01,
                                     1.8458637e-01, 1.8439093e-01, 1.8419591e-01, 1.8400131e-01, 1.8380711e-01,
                                     1.8361332e-01, 1.8341995e-01, 1.8322698e-01, 1.8303441e-01, 1.8284226e-01,
                                     1.8265050e-01, 1.8245915e-01, 1.8226820e-01, 1.8207764e-01, 1.8188749e-01,
                                     1.8169773e-01, 1.8150837e-01, 1.8131941e-01, 1.8113083e-01, 1.8094265e-01,
                                     1.8075486e-01, 1.8056746e-01, 1.8038045e-01, 1.8019383e-01, 1.8000759e-01,
                                     1.7982174e-01, 1.7963627e-01, 1.7945119e-01, 1.7926648e-01, 1.7908216e-01,
                                     1.7889822e-01, 1.7871465e-01, 1.7853146e-01, 1.7834864e-01, 1.7816620e-01,
                                     1.7798414e-01, 1.7780244e-01, 1.7762112e-01, 1.7744016e-01, 1.7725958e-01,
                                     1.7707936e-01, 1.7689951e-01, 1.7672002e-01, 1.7654090e-01, 1.7636214e-01,
                                     1.7618375e-01, 1.7600571e-01, 1.7582804e-01, 1.7565072e-01, 1.7547376e-01,
                                     1.7529716e-01, 1.7512091e-01, 1.7494502e-01, 1.7476948e-01, 1.7459429e-01,
                                     1.7441946e-01, 1.7424497e-01, 1.7407084e-01, 1.7389705e-01, 1.7372361e-01,
                                     1.7355051e-01, 1.7337776e-01, 1.7320535e-01, 1.7303329e-01, 1.7286157e-01,
                                     1.7269019e-01, 1.7251915e-01, 1.7234844e-01, 1.7217808e-01, 1.7200805e-01,
                                     1.7183836e-01, 1.7166900e-01, 1.7149998e-01, 1.7133129e-01, 1.7116293e-01,
                                     1.7099491e-01, 1.7082721e-01, 1.7065984e-01, 1.7049280e-01, 1.7032608e-01,
                                     1.7015970e-01, 1.6999363e-01, 1.6982790e-01, 1.6966248e-01, 1.6949739e-01,
                                     1.6933262e-01, 1.6916817e-01, 1.6900403e-01, 1.6884022e-01, 1.6867672e-01,
                                     1.6851355e-01, 1.6835068e-01, 1.6818813e-01, 1.6802590e-01, 1.6786398e-01,
                                     1.6770237e-01, 1.6754107e-01, 1.6738008e-01, 1.6721940e-01, 1.6705903e-01,
                                     1.6689897e-01, 1.6673921e-01, 1.6657976e-01, 1.6642062e-01, 1.6626178e-01,
                                     1.6610324e-01, 1.6594500e-01, 1.6578707e-01, 1.6562944e-01, 1.6547210e-01,
                                     1.6531507e-01, 1.6515833e-01, 1.6500189e-01, 1.6484575e-01, 1.6468990e-01,
                                     1.6453435e-01, 1.6437909e-01, 1.6422412e-01, 1.6406945e-01, 1.6391507e-01,
                                     1.6376098e-01, 1.6360717e-01, 1.6345366e-01, 1.6330044e-01, 1.6314750e-01,
                                     1.6299485e-01, 1.6284248e-01, 1.6269040e-01, 1.6253860e-01, 1.6238709e-01,
                                     1.6223586e-01, 1.6208491e-01, 1.6193424e-01, 1.6178385e-01, 1.6163374e-01};

  static const std::vector<float> cs = {1.0001000e+00, 1.0091089e+00, 1.0181178e+00, 1.0271267e+00, 1.0361356e+00,
                                  1.0451445e+00,
                                  1.0541535e+00, 1.0631624e+00, 1.0721713e+00, 1.0811802e+00, 1.0901891e+00,
                                  1.0991980e+00, 1.1082069e+00,
                                  1.1172158e+00, 1.1262247e+00, 1.1352336e+00, 1.1442425e+00, 1.1532515e+00,
                                  1.1622604e+00, 1.1712693e+00,
                                  1.1802782e+00, 1.1892871e+00, 1.1982960e+00, 1.2073049e+00, 1.2163138e+00,
                                  1.2253227e+00, 1.2343316e+00,
                                  1.2433405e+00, 1.2523494e+00, 1.2613584e+00, 1.2703673e+00, 1.2793762e+00,
                                  1.2883851e+00, 1.2973940e+00,
                                  1.3064029e+00, 1.3154118e+00, 1.3244207e+00, 1.3334296e+00, 1.3424385e+00,
                                  1.3514474e+00, 1.3604564e+00,
                                  1.3694653e+00, 1.3784742e+00, 1.3874831e+00, 1.3964920e+00, 1.4055009e+00,
                                  1.4145098e+00, 1.4235187e+00,
                                  1.4325276e+00, 1.4415365e+00, 1.4505454e+00, 1.4595544e+00, 1.4685633e+00,
                                  1.4775722e+00, 1.4865811e+00,
                                  1.4955900e+00, 1.5045989e+00, 1.5136078e+00, 1.5226167e+00, 1.5316256e+00,
                                  1.5406345e+00, 1.5496434e+00,
                                  1.5586524e+00, 1.5676613e+00, 1.5766702e+00, 1.5856791e+00, 1.5946880e+00,
                                  1.6036969e+00, 1.6127058e+00, 1.6217147e+00, 1.6307236e+00, 1.6397325e+00,
                                  1.6487414e+00, 1.6577504e+00, 1.6667593e+00, 1.6757682e+00, 1.6847771e+00,
                                  1.6937860e+00, 1.7027949e+00, 1.7118038e+00, 1.7208127e+00, 1.7298216e+00,
                                  1.7388305e+00, 1.7478394e+00, 1.7568483e+00, 1.7658573e+00, 1.7748662e+00,
                                  1.7838751e+00, 1.7928840e+00, 1.8018929e+00, 1.8109018e+00, 1.8199107e+00,
                                  1.8289196e+00, 1.8379285e+00, 1.8469374e+00, 1.8559463e+00, 1.8649553e+00,
                                  1.8739642e+00, 1.8829731e+00, 1.8919820e+00, 1.9009909e+00, 1.9099998e+00,
                                  1.9190087e+00, 1.9280176e+00, 1.9370265e+00, 1.9460354e+00, 1.9550443e+00,
                                  1.9640533e+00, 1.9730622e+00, 1.9820711e+00, 1.9910800e+00, 2.0000889e+00,
                                  2.0090978e+00, 2.0181067e+00, 2.0271156e+00, 2.0361245e+00, 2.0451334e+00,
                                  2.0541423e+00, 2.0631513e+00, 2.0721602e+00, 2.0811691e+00, 2.0901780e+00,
                                  2.0991869e+00, 2.1081958e+00, 2.1172047e+00, 2.1262136e+00, 2.1352225e+00,
                                  2.1442314e+00, 2.1532403e+00, 2.1622492e+00, 2.1712582e+00, 2.1802671e+00,
                                  2.1892760e+00, 2.1982849e+00, 2.2072938e+00, 2.2163027e+00, 2.2253116e+00,
                                  2.2343205e+00, 2.2433294e+00, 2.2523383e+00, 2.2613472e+00, 2.2703562e+00,
                                  2.2793651e+00, 2.2883740e+00, 2.2973829e+00, 2.3063918e+00, 2.3154007e+00,
                                  2.3244096e+00, 2.3334185e+00, 2.3424274e+00, 2.3514363e+00, 2.3604452e+00,
                                  2.3694542e+00, 2.3784631e+00, 2.3874720e+00, 2.3964809e+00, 2.4054898e+00,
                                  2.4144987e+00, 2.4235076e+00, 2.4325165e+00, 2.4415254e+00, 2.4505343e+00,
                                  2.4595432e+00, 2.4685522e+00, 2.4775611e+00, 2.4865700e+00, 2.4955789e+00,
                                  2.5045878e+00, 2.5135967e+00, 2.5226056e+00, 2.5316145e+00, 2.5406234e+00,
                                  2.5496323e+00, 2.5586412e+00, 2.5676502e+00, 2.5766591e+00, 2.5856680e+00,
                                  2.5946769e+00, 2.6036858e+00, 2.6126947e+00, 2.6217036e+00, 2.6307125e+00,
                                  2.6397214e+00, 2.6487303e+00, 2.6577392e+00, 2.6667481e+00, 2.6757571e+00,
                                  2.6847660e+00, 2.6937749e+00, 2.7027838e+00, 2.7117927e+00, 2.7208016e+00,
                                  2.7298105e+00, 2.7388194e+00, 2.7478283e+00, 2.7568372e+00, 2.7658461e+00,
                                  2.7748551e+00, 2.7838640e+00, 2.7928729e+00, 2.8018818e+00, 2.8108907e+00,
                                  2.8198996e+00, 2.8289085e+00, 2.8379174e+00, 2.8469263e+00, 2.8559352e+00,
                                  2.8649441e+00, 2.8739531e+00, 2.8829620e+00, 2.8919709e+00, 2.9009798e+00,
                                  2.9099887e+00, 2.9189976e+00, 2.9280065e+00, 2.9370154e+00, 2.9460243e+00,
                                  2.9550332e+00, 2.9640421e+00, 2.9730511e+00, 2.9820600e+00, 2.9910689e+00,
                                  3.0000778e+00, 3.0090867e+00, 3.0180956e+00, 3.0271045e+00, 3.0361134e+00,
                                  3.0451223e+00, 3.0541312e+00, 3.0631401e+00, 3.0721490e+00, 3.0811580e+00,
                                  3.0901669e+00, 3.0991758e+00, 3.1081847e+00, 3.1171936e+00, 3.1262025e+00,
                                  3.1352114e+00, 3.1442203e+00, 3.1532292e+00, 3.1622381e+00, 3.1712470e+00,
                                  3.1802560e+00, 3.1892649e+00, 3.1982738e+00, 3.2072827e+00, 3.2162916e+00,
                                  3.2253005e+00, 3.2343094e+00, 3.2433183e+00, 3.2523272e+00, 3.2613361e+00,
                                  3.2703450e+00, 3.2793540e+00, 3.2883629e+00, 3.2973718e+00, 3.3063807e+00,
                                  3.3153896e+00, 3.3243985e+00, 3.3334074e+00, 3.3424163e+00, 3.3514252e+00,
                                  3.3604341e+00, 3.3694430e+00, 3.3784520e+00, 3.3874609e+00, 3.3964698e+00,
                                  3.4054787e+00, 3.4144876e+00, 3.4234965e+00, 3.4325054e+00, 3.4415143e+00,
                                  3.4505232e+00, 3.4595321e+00, 3.4685410e+00, 3.4775499e+00, 3.4865589e+00,
                                  3.4955678e+00, 3.5045767e+00, 3.5135856e+00, 3.5225945e+00, 3.5316034e+00,
                                  3.5406123e+00, 3.5496212e+00, 3.5586301e+00, 3.5676390e+00, 3.5766479e+00,
                                  3.5856569e+00, 3.5946658e+00, 3.6036747e+00, 3.6126836e+00, 3.6216925e+00,
                                  3.6307014e+00, 3.6397103e+00, 3.6487192e+00, 3.6577281e+00, 3.6667370e+00,
                                  3.6757459e+00, 3.6847549e+00, 3.6937638e+00, 3.7027727e+00, 3.7117816e+00,
                                  3.7207905e+00, 3.7297994e+00, 3.7388083e+00, 3.7478172e+00, 3.7568261e+00,
                                  3.7658350e+00, 3.7748439e+00, 3.7838529e+00, 3.7928618e+00, 3.8018707e+00,
                                  3.8108796e+00, 3.8198885e+00, 3.8288974e+00, 3.8379063e+00, 3.8469152e+00,
                                  3.8559241e+00, 3.8649330e+00, 3.8739419e+00, 3.8829509e+00, 3.8919598e+00,
                                  3.9009687e+00, 3.9099776e+00, 3.9189865e+00, 3.9279954e+00, 3.9370043e+00,
                                  3.9460132e+00, 3.9550221e+00, 3.9640310e+00, 3.9730399e+00, 3.9820488e+00,
                                  3.9910578e+00, 4.0000667e+00, 4.0090756e+00, 4.0180845e+00, 4.0270934e+00,
                                  4.0361023e+00, 4.0451112e+00, 4.0541201e+00, 4.0631290e+00, 4.0721379e+00,
                                  4.0811468e+00, 4.0901558e+00, 4.0991647e+00, 4.1081736e+00, 4.1171825e+00,
                                  4.1261914e+00, 4.1352003e+00, 4.1442092e+00, 4.1532181e+00, 4.1622270e+00,
                                  4.1712359e+00, 4.1802448e+00, 4.1892538e+00, 4.1982627e+00, 4.2072716e+00,
                                  4.2162805e+00, 4.2252894e+00, 4.2342983e+00, 4.2433072e+00, 4.2523161e+00,
                                  4.2613250e+00, 4.2703339e+00, 4.2793428e+00, 4.2883518e+00, 4.2973607e+00,
                                  4.3063696e+00, 4.3153785e+00, 4.3243874e+00, 4.3333963e+00, 4.3424052e+00,
                                  4.3514141e+00, 4.3604230e+00, 4.3694319e+00, 4.3784408e+00, 4.3874497e+00,
                                  4.3964587e+00, 4.4054676e+00, 4.4144765e+00, 4.4234854e+00, 4.4324943e+00,
                                  4.4415032e+00, 4.4505121e+00, 4.4595210e+00, 4.4685299e+00, 4.4775388e+00,
                                  4.4865477e+00, 4.4955567e+00, 4.5045656e+00, 4.5135745e+00, 4.5225834e+00,
                                  4.5315923e+00, 4.5406012e+00, 4.5496101e+00, 4.5586190e+00, 4.5676279e+00,
                                  4.5766368e+00, 4.5856457e+00, 4.5946547e+00, 4.6036636e+00, 4.6126725e+00,
                                  4.6216814e+00, 4.6306903e+00, 4.6396992e+00, 4.6487081e+00, 4.6577170e+00,
                                  4.6667259e+00, 4.6757348e+00, 4.6847437e+00, 4.6937527e+00, 4.7027616e+00,
                                  4.7117705e+00, 4.7207794e+00, 4.7297883e+00, 4.7387972e+00, 4.7478061e+00,
                                  4.7568150e+00, 4.7658239e+00, 4.7748328e+00, 4.7838417e+00, 4.7928507e+00,
                                  4.8018596e+00, 4.8108685e+00, 4.8198774e+00, 4.8288863e+00, 4.8378952e+00,
                                  4.8469041e+00, 4.8559130e+00, 4.8649219e+00, 4.8739308e+00, 4.8829397e+00,
                                  4.8919486e+00, 4.9009576e+00, 4.9099665e+00, 4.9189754e+00, 4.9279843e+00,
                                  4.9369932e+00, 4.9460021e+00, 4.9550110e+00, 4.9640199e+00, 4.9730288e+00,
                                  4.9820377e+00, 4.9910466e+00, 5.0000556e+00, 5.0090645e+00, 5.0180734e+00,
                                  5.0270823e+00, 5.0360912e+00, 5.0451001e+00, 5.0541090e+00, 5.0631179e+00,
                                  5.0721268e+00, 5.0811357e+00, 5.0901446e+00, 5.0991536e+00, 5.1081625e+00,
                                  5.1171714e+00, 5.1261803e+00, 5.1351892e+00, 5.1441981e+00, 5.1532070e+00,
                                  5.1622159e+00, 5.1712248e+00, 5.1802337e+00, 5.1892426e+00, 5.1982516e+00,
                                  5.2072605e+00, 5.2162694e+00, 5.2252783e+00, 5.2342872e+00, 5.2432961e+00,
                                  5.2523050e+00, 5.2613139e+00, 5.2703228e+00, 5.2793317e+00, 5.2883406e+00,
                                  5.2973495e+00, 5.3063585e+00, 5.3153674e+00, 5.3243763e+00, 5.3333852e+00,
                                  5.3423941e+00, 5.3514030e+00, 5.3604119e+00, 5.3694208e+00, 5.3784297e+00,
                                  5.3874386e+00, 5.3964475e+00, 5.4054565e+00, 5.4144654e+00, 5.4234743e+00,
                                  5.4324832e+00, 5.4414921e+00, 5.4505010e+00, 5.4595099e+00, 5.4685188e+00,
                                  5.4775277e+00, 5.4865366e+00, 5.4955455e+00, 5.5045545e+00, 5.5135634e+00,
                                  5.5225723e+00, 5.5315812e+00, 5.5405901e+00, 5.5495990e+00, 5.5586079e+00,
                                  5.5676168e+00, 5.5766257e+00, 5.5856346e+00, 5.5946435e+00, 5.6036525e+00,
                                  5.6126614e+00, 5.6216703e+00, 5.6306792e+00, 5.6396881e+00, 5.6486970e+00,
                                  5.6577059e+00, 5.6667148e+00, 5.6757237e+00, 5.6847326e+00, 5.6937415e+00,
                                  5.7027505e+00, 5.7117594e+00, 5.7207683e+00, 5.7297772e+00, 5.7387861e+00,
                                  5.7477950e+00, 5.7568039e+00, 5.7658128e+00, 5.7748217e+00, 5.7838306e+00,
                                  5.7928395e+00, 5.8018484e+00, 5.8108574e+00, 5.8198663e+00, 5.8288752e+00,
                                  5.8378841e+00, 5.8468930e+00, 5.8559019e+00, 5.8649108e+00, 5.8739197e+00,
                                  5.8829286e+00, 5.8919375e+00, 5.9009464e+00, 5.9099554e+00, 5.9189643e+00,
                                  5.9279732e+00, 5.9369821e+00, 5.9459910e+00, 5.9549999e+00, 5.9640088e+00,
                                  5.9730177e+00, 5.9820266e+00, 5.9910355e+00, 6.0000444e+00, 6.0090534e+00,
                                  6.0180623e+00, 6.0270712e+00, 6.0360801e+00, 6.0450890e+00, 6.0540979e+00,
                                  6.0631068e+00, 6.0721157e+00, 6.0811246e+00, 6.0901335e+00, 6.0991424e+00,
                                  6.1081514e+00, 6.1171603e+00, 6.1261692e+00, 6.1351781e+00, 6.1441870e+00,
                                  6.1531959e+00, 6.1622048e+00, 6.1712137e+00, 6.1802226e+00, 6.1892315e+00,
                                  6.1982404e+00, 6.2072493e+00, 6.2162583e+00, 6.2252672e+00, 6.2342761e+00,
                                  6.2432850e+00, 6.2522939e+00, 6.2613028e+00, 6.2703117e+00, 6.2793206e+00,
                                  6.2883295e+00, 6.2973384e+00, 6.3063473e+00, 6.3153563e+00, 6.3243652e+00,
                                  6.3333741e+00, 6.3423830e+00, 6.3513919e+00, 6.3604008e+00, 6.3694097e+00,
                                  6.3784186e+00, 6.3874275e+00, 6.3964364e+00, 6.4054453e+00, 6.4144543e+00,
                                  6.4234632e+00, 6.4324721e+00, 6.4414810e+00, 6.4504899e+00, 6.4594988e+00,
                                  6.4685077e+00, 6.4775166e+00, 6.4865255e+00, 6.4955344e+00, 6.5045433e+00,
                                  6.5135523e+00, 6.5225612e+00, 6.5315701e+00, 6.5405790e+00, 6.5495879e+00,
                                  6.5585968e+00, 6.5676057e+00, 6.5766146e+00, 6.5856235e+00, 6.5946324e+00,
                                  6.6036413e+00, 6.6126503e+00, 6.6216592e+00, 6.6306681e+00, 6.6396770e+00,
                                  6.6486859e+00, 6.6576948e+00, 6.6667037e+00, 6.6757126e+00, 6.6847215e+00,
                                  6.6937304e+00, 6.7027393e+00, 6.7117482e+00, 6.7207572e+00, 6.7297661e+00,
                                  6.7387750e+00, 6.7477839e+00, 6.7567928e+00, 6.7658017e+00, 6.7748106e+00,
                                  6.7838195e+00, 6.7928284e+00, 6.8018373e+00, 6.8108462e+00, 6.8198552e+00,
                                  6.8288641e+00, 6.8378730e+00, 6.8468819e+00, 6.8558908e+00, 6.8648997e+00,
                                  6.8739086e+00, 6.8829175e+00, 6.8919264e+00, 6.9009353e+00, 6.9099442e+00,
                                  6.9189532e+00, 6.9279621e+00, 6.9369710e+00, 6.9459799e+00, 6.9549888e+00,
                                  6.9639977e+00, 6.9730066e+00, 6.9820155e+00, 6.9910244e+00, 7.0000333e+00,
                                  7.0090422e+00, 7.0180512e+00, 7.0270601e+00, 7.0360690e+00, 7.0450779e+00,
                                  7.0540868e+00, 7.0630957e+00, 7.0721046e+00, 7.0811135e+00, 7.0901224e+00,
                                  7.0991313e+00, 7.1081402e+00, 7.1171491e+00, 7.1261581e+00, 7.1351670e+00,
                                  7.1441759e+00, 7.1531848e+00, 7.1621937e+00, 7.1712026e+00, 7.1802115e+00,
                                  7.1892204e+00, 7.1982293e+00, 7.2072382e+00, 7.2162471e+00, 7.2252561e+00,
                                  7.2342650e+00, 7.2432739e+00, 7.2522828e+00, 7.2612917e+00, 7.2703006e+00,
                                  7.2793095e+00, 7.2883184e+00, 7.2973273e+00, 7.3063362e+00, 7.3153451e+00,
                                  7.3243541e+00, 7.3333630e+00, 7.3423719e+00, 7.3513808e+00, 7.3603897e+00,
                                  7.3693986e+00, 7.3784075e+00, 7.3874164e+00, 7.3964253e+00, 7.4054342e+00,
                                  7.4144431e+00, 7.4234521e+00, 7.4324610e+00, 7.4414699e+00, 7.4504788e+00,
                                  7.4594877e+00, 7.4684966e+00, 7.4775055e+00, 7.4865144e+00, 7.4955233e+00,
                                  7.5045322e+00, 7.5135411e+00, 7.5225501e+00, 7.5315590e+00, 7.5405679e+00,
                                  7.5495768e+00, 7.5585857e+00, 7.5675946e+00, 7.5766035e+00, 7.5856124e+00,
                                  7.5946213e+00, 7.6036302e+00, 7.6126391e+00, 7.6216480e+00, 7.6306570e+00,
                                  7.6396659e+00, 7.6486748e+00, 7.6576837e+00, 7.6666926e+00, 7.6757015e+00,
                                  7.6847104e+00, 7.6937193e+00, 7.7027282e+00, 7.7117371e+00, 7.7207460e+00,
                                  7.7297550e+00, 7.7387639e+00, 7.7477728e+00, 7.7567817e+00, 7.7657906e+00,
                                  7.7747995e+00, 7.7838084e+00, 7.7928173e+00, 7.8018262e+00, 7.8108351e+00,
                                  7.8198440e+00, 7.8288530e+00, 7.8378619e+00, 7.8468708e+00, 7.8558797e+00,
                                  7.8648886e+00, 7.8738975e+00, 7.8829064e+00, 7.8919153e+00, 7.9009242e+00,
                                  7.9099331e+00, 7.9189420e+00, 7.9279510e+00, 7.9369599e+00, 7.9459688e+00,
                                  7.9549777e+00, 7.9639866e+00, 7.9729955e+00, 7.9820044e+00, 7.9910133e+00,
                                  8.0000222e+00, 8.0090311e+00, 8.0180400e+00, 8.0270489e+00, 8.0360579e+00,
                                  8.0450668e+00, 8.0540757e+00, 8.0630846e+00, 8.0720935e+00, 8.0811024e+00,
                                  8.0901113e+00, 8.0991202e+00, 8.1081291e+00, 8.1171380e+00, 8.1261469e+00,
                                  8.1351559e+00, 8.1441648e+00, 8.1531737e+00, 8.1621826e+00, 8.1711915e+00,
                                  8.1802004e+00, 8.1892093e+00, 8.1982182e+00, 8.2072271e+00, 8.2162360e+00,
                                  8.2252449e+00, 8.2342539e+00, 8.2432628e+00, 8.2522717e+00, 8.2612806e+00,
                                  8.2702895e+00, 8.2792984e+00, 8.2883073e+00, 8.2973162e+00, 8.3063251e+00,
                                  8.3153340e+00, 8.3243429e+00, 8.3333519e+00, 8.3423608e+00, 8.3513697e+00,
                                  8.3603786e+00, 8.3693875e+00, 8.3783964e+00, 8.3874053e+00, 8.3964142e+00,
                                  8.4054231e+00, 8.4144320e+00, 8.4234409e+00, 8.4324498e+00, 8.4414588e+00,
                                  8.4504677e+00, 8.4594766e+00, 8.4684855e+00, 8.4774944e+00, 8.4865033e+00,
                                  8.4955122e+00, 8.5045211e+00, 8.5135300e+00, 8.5225389e+00, 8.5315478e+00,
                                  8.5405568e+00, 8.5495657e+00, 8.5585746e+00, 8.5675835e+00, 8.5765924e+00,
                                  8.5856013e+00, 8.5946102e+00, 8.6036191e+00, 8.6126280e+00, 8.6216369e+00,
                                  8.6306458e+00, 8.6396548e+00, 8.6486637e+00, 8.6576726e+00, 8.6666815e+00,
                                  8.6756904e+00, 8.6846993e+00, 8.6937082e+00, 8.7027171e+00, 8.7117260e+00,
                                  8.7207349e+00, 8.7297438e+00, 8.7387528e+00, 8.7477617e+00, 8.7567706e+00,
                                  8.7657795e+00, 8.7747884e+00, 8.7837973e+00, 8.7928062e+00, 8.8018151e+00,
                                  8.8108240e+00, 8.8198329e+00, 8.8288418e+00, 8.8378508e+00, 8.8468597e+00,
                                  8.8558686e+00, 8.8648775e+00, 8.8738864e+00, 8.8828953e+00, 8.8919042e+00,
                                  8.9009131e+00, 8.9099220e+00, 8.9189309e+00, 8.9279398e+00, 8.9369487e+00,
                                  8.9459577e+00, 8.9549666e+00, 8.9639755e+00, 8.9729844e+00, 8.9819933e+00,
                                  8.9910022e+00, 9.0000111e+00, 9.0090200e+00, 9.0180289e+00, 9.0270378e+00,
                                  9.0360467e+00, 9.0450557e+00, 9.0540646e+00, 9.0630735e+00, 9.0720824e+00,
                                  9.0810913e+00, 9.0901002e+00, 9.0991091e+00, 9.1081180e+00, 9.1171269e+00,
                                  9.1261358e+00, 9.1351447e+00, 9.1441537e+00, 9.1531626e+00, 9.1621715e+00,
                                  9.1711804e+00, 9.1801893e+00, 9.1891982e+00, 9.1982071e+00, 9.2072160e+00,
                                  9.2162249e+00, 9.2252338e+00, 9.2342427e+00, 9.2432517e+00, 9.2522606e+00,
                                  9.2612695e+00, 9.2702784e+00, 9.2792873e+00, 9.2882962e+00, 9.2973051e+00,
                                  9.3063140e+00, 9.3153229e+00, 9.3243318e+00, 9.3333407e+00, 9.3423496e+00,
                                  9.3513586e+00, 9.3603675e+00, 9.3693764e+00, 9.3783853e+00, 9.3873942e+00,
                                  9.3964031e+00, 9.4054120e+00, 9.4144209e+00, 9.4234298e+00, 9.4324387e+00,
                                  9.4414476e+00, 9.4504566e+00, 9.4594655e+00, 9.4684744e+00, 9.4774833e+00,
                                  9.4864922e+00, 9.4955011e+00, 9.5045100e+00, 9.5135189e+00, 9.5225278e+00,
                                  9.5315367e+00, 9.5405456e+00, 9.5495546e+00, 9.5585635e+00, 9.5675724e+00,
                                  9.5765813e+00, 9.5855902e+00, 9.5945991e+00, 9.6036080e+00, 9.6126169e+00,
                                  9.6216258e+00, 9.6306347e+00, 9.6396436e+00, 9.6486526e+00, 9.6576615e+00,
                                  9.6666704e+00, 9.6756793e+00, 9.6846882e+00, 9.6936971e+00, 9.7027060e+00,
                                  9.7117149e+00, 9.7207238e+00, 9.7297327e+00, 9.7387416e+00, 9.7477506e+00,
                                  9.7567595e+00, 9.7657684e+00, 9.7747773e+00, 9.7837862e+00, 9.7927951e+00,
                                  9.8018040e+00, 9.8108129e+00, 9.8198218e+00, 9.8288307e+00, 9.8378396e+00,
                                  9.8468485e+00, 9.8558575e+00, 9.8648664e+00, 9.8738753e+00, 9.8828842e+00,
                                  9.8918931e+00, 9.9009020e+00, 9.9099109e+00, 9.9189198e+00, 9.9279287e+00,
                                  9.9369376e+00, 9.9459465e+00, 9.9549555e+00, 9.9639644e+00, 9.9729733e+00,
                                  9.9819822e+00, 9.9909911e+00, 1.0000000e+00};

  assert( times.size() == cs.size());

  // TODO: extrapolieren
  // TODO: interpolieren
  unsigned int i;
  i= 0;
  for(;i < times.size()-1; i++)
  {
    if (tf > times[i])
    {
      return cs[i];
    }
  }

std::cout << "calculate coupling: ausserhalb Wertebereich! tf: " << tf << ", min ist: " << times[times.size()-1] << std::endl;
  return *(cs.end());
}

float cedar::proc::steps::NeuralTimer::calculateInputS(float D, float
c, float tf, float tau, float h)
{
  float C3 = ( c*c -1 ) / ( (c+1)*(c+1) );
  //( c - 1 ) / ( c + 1 );

  float nenner = tau*tau*(c+1.0)/pow(c*c+1, 2.0)
                 *(c + C3 - C3*tf/tau*(c*c+1.0)
                   + exp( -tf/tau )
                     * ( - sin(c*tf/tau) - c*cos(c*tf/tau) + c*C3*sin(c*tf/tau) - C3*cos(c*tf/tau) ));
  float newS = D / nenner - h; // h is negative!

  return newS;
}

float cedar::proc::steps::NeuralTimer::calculateBaseIntegral(float s, float
c, float tf, float tau, float h)
{
  float C3 = ( c*c -1 ) / ( (c+1)*(c+1) );
  //( c - 1 ) / ( c + 1 );

  float nenner = tau*tau*(c+1.0)/pow(c*c+1, 2.0)
                 *(c + C3 - C3*tf/tau*(c*c+1.0)
                   + exp( -tf/tau )
                     * ( - sin(c*tf/tau) - c*cos(c*tf/tau) + c*C3*sin(c*tf/tau) - C3*cos(c*tf/tau) ));

  float newD = ( s + h ) * (nenner);
  return newD;
}

float cedar::proc::steps::NeuralTimer::calculateUofT(float t, float s, float c, float tau, float h)
{
  float C1 = ( c + 1 ) / ( pow(c, 2.0) + 1 );
  float C2 = ( pow( c, 2.0 ) - 1 ) / pow( c+1, 2.0 );

  return tau * ( h + s ) * C1 
         * ( exp( -t/tau ) * sin( c*t/tau ) 
             + C2 * ( exp( -t/tau ) * cos( c*t/tau ) - 1 ) 
           );
}

float cedar::proc::steps::NeuralTimer::calculateUDotofT(float t, float s, float c, float tau, float h)
{
  float C1 = ( c + 1 ) / ( pow(c, 2.0) + 1 );
  float C2 = ( pow( c, 2.0 ) - 1 ) / pow( c+1, 2.0 );

  return tau * ( h + s ) * C1 / tau
         * ( C2 * ( - c * exp( -t/tau ) * sin( c*t/tau ) 
                    - exp( -t/tau) * cos( c*t/tau ) )
             - exp( -t/tau ) * sin( c*t/tau ) 
             + c*exp( -t/tau ) * cos( c*t/tau ) 
           );
}

float cedar::proc::steps::NeuralTimer::calculateTMaxOfU(float c)
{
  float C2 = ( pow( c, 2.0 ) - 1 ) / pow( c+1, 2.0 );

  // nulldurchgang der Ableitung
  return 2.0 / c 
                 * atan( ( - sqrt( ( pow( C2, 2.0 ) + 1 ) 
                                   * ( pow( c, 2.0 ) + 1 )  
                                 )  
                           + C2*c + 1 
                          )
                          / ( C2 - c )
                       );
}

float cedar::proc::steps::NeuralTimer::calculateModIntegral(float s, float
c, float tofmax, float tau, float h)
{
//std::cout << "  tofmax: " << tofmax << "  u of tofmax: " << calculateUofT(tofmax, s, c, tau, h) << "  tau: " << tau << " h: " << h << " s: " << s << std::endl;  
  return calculateUofT(tofmax, s, c, tau, h);
}

